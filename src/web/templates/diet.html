{% extends "layout.html" %}

{% block content %}
<div class="card">
    <h2>Log Diet üçé</h2>
    <p class="text-gray-600">Enter your meals naturally (e.g., "Bf - 2 eggs... Lunch - chicken rice").</p>

    <form action="/diet" method="POST">
        <textarea name="raw_input" rows="6"
            placeholder="Bf - Oatmeal and banana&#10;Lunch - Chicken salad&#10;Snack - Apple">{{ raw_input }}</textarea>

        <label style="display:block; margin-bottom:8px; font-weight:500;">Date:</label>
        <input type="date" name="date" value="{{ today }}"
            style="padding:8px; border:1px solid #ccc; border-radius:4px; margin-bottom:20px;">

        <button type="submit" class="btn">Estimate Calories</button>
    </form>
</div>

{% if preview_items %}
<div class="card" style="background:#f0f9ff; border:1px solid #bae6fd;">
    <h3>Stats Estimation</h3>
    <table>
        <thead>
            <tr>
                <th>Meal</th>
                <th>Item</th>
                <th>Cals</th>
                <th>P</th>
                <th>C</th>
                <th>F</th>
            </tr>
        </thead>
        <tbody>
            {% for item in preview_items %}
            <tr>
                <td><span class="badge">{{ item.meal_type }}</span></td>
                <td>{{ item.food_raw }}</td>
                <td>{{ item.calories }}</td>
                <td>{{ item.protein }}g</td>
                <td>{{ item.carbs }}g</td>
                <td>{{ item.fats }}g</td>
            </tr>
            {% endfor %}
            <tr style="font-weight:bold; background:#e0f2fe;">
                <td colspan="2">TOTAL</td>
                <td>{{ total_cals }}</td>
                <td>{{ total_p }}g</td>
                <td>{{ total_c }}g</td>
                <td>{{ total_f }}g</td>
            </tr>
        </tbody>
    </table>

    <form action="/confirm_diet" method="POST" style="margin-top:20px;">
        <input type="hidden" name="date" value="{{ date }}">
        <input type="hidden" name="items_json" value="{{ items_json }}">
        <button type="submit" class="btn" style="background:#16a34a;">Save Log</button>
        <a href="/diet" class="btn" style="background:#dc2626; margin-left:10px;">Cancel</a>
    </form>
</div>
{% endif %}

<div class="card">
    <h3>Recent Diet History</h3>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Meal</th>
                <th>Food</th>
                <th>Cals</th>
            </tr>
        </thead>
        <tbody>
            {% for row in history %}
            <tr>
                <td>{{ row[1] }}</td>
                <td><span class="badge">{{ row[2] }}</span></td>
                <td>{{ row[3] }}</td>
                <td>{{ row[4] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}